#{extends 'web.html' /}
#{set title : document.title/}
#{set 'subTitle'}
    &{'edit.documentDetails'}
#{/set}
#{i18n keys:['document.update.error.notice', 'document.update.success.notice'] /}
<div class="row-fluid">
    <div class="span12">
        <div class="alert hide" id="result">
            <p class="message">
            </p>
        </div>
        #{form @api.Documents.updateDetails(document.id), enctype:'multipart/form-data', class : 'form-horizontal'}
            #{field 'title'}
                #{form.input field : field, value : document?.title, class : 'input-xxlarge', required  : true /}
            #{/field}
            #{field 'category.id'}
                #{form.select field : field, items : categories, valueProperty : 'id', labelProperty : 'name',  value : document?.category?.id /}
            #{/field}
            #{field 'source'}
                #{form.input field : field, value : document?.source, class : 'input-xxlarge', required  : false /}
            #{/field}
            <div class="form-actions">
                <input type="submit" value="&{'update.documentDetails'}" class="btn btn-primary" data-loading-text="&{'loading'}"/>
            </div>
        #{/form}

        #{a @api.Documents.delete(document.id), class : 'btn btn-danger', 'data-loading-text' : messages.get('loading')}&{'delete.document'}#{/a}
    </div>
</div>
#{set 'moreScripts'}
<script type="text/javascript">
    $('button.btn').button();
    $(document).ready(function() {
         $('.btn-primary').click(function() {
            var btn = this;
            $(btn).button('loading');
            var updateDocumentDetailsAction = #{jsRoute @api.Documents.updateDetails(':id') /}
            $.ajax({
                url : updateDocumentDetailsAction.url({id : ${document.id}}),
                type : updateDocumentDetailsAction.method,
                data : $('form').serialize()
            }).success(function(data) {            
                $('#result').addClass('alert-success').html(i18n('document.update.success.notice'));
                console.log(data);
            }).error(function(data) {                
                $('#result').addClass('alert-error').html(i18n('document.update.error.notice'));
            }).complete(function() {
                $('#result').removeClass('hide');
                $(btn).button('reset');
            });
            return false;
         });
         
         $('.btn-danger').click(function() {
            var btn = this;
            $(btn).button('loading');
            var deleteDocumentAction = #{jsRoute @api.Documents.delete(':id') /}
            $.ajax({
                url : deleteDocumentAction.url({id : ${document.id}}),
                type : deleteDocumentAction.method,
                data : { authenticityToken : '${session.authenticityToken}'}
            }).success(function(data) {            
                $('#result').addClass('alert-success').html(i18n('document.update.success.notice'));
                console.log(data);
                windowLocation = '@@{web.Documents.list()}';
            }).error(function(data) {                
                $('#result').addClass('alert-error').html(i18n('document.update.error.notice'));
            }).complete(function() {
                $('#result').removeClass('hide');
                $(btn).button('reset');
            });
            return false;
         });
    });
</script>
#{/set}